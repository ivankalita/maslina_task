<template lang="pug">
    .modal-reg
        .modal-reg__header
            img.image-logo(src="/assets/images/brand_logo.png")
            .close-icon(
                :style="'/assets/images/icons/cancel_icon.svg' | styleImageBgr"
                @click="$emit('close')")
        .modal-reg__body
            .title Регистрация
            .phone(:class="{ 'selected': isPhoneFocus }")
                masked-input(
                    type="text"
                    placeholder="+7 (903) 888-88-88"
                    @focus="isPhoneFocus = true"
                    @blur="isPhoneFocus = false"
                    @input="validPhone"
                    v-model="phoneNumber"
                    :mask="russiaPhoneMask"
                    :keep-char-positions="true"
                    :placeholder-char="'\u2000'")
            p.descr На этот телефон буду приходить промо-коды на скидку
            p.invite-text Или зарегестрируйтесь с помощью соцсети
            ul.social-list
                li.social-list__item
                    a.link(href="https://www.facebook.com")
                        svg.link__icon(width='9' height='18' viewbox='0 0 9 18' fill='none' xmlns='http://www.w3.org/2000/svg')
                            path(d='M5.84076 18V9.78943H8.49429L8.89154 6.5896H5.84076V4.54666C5.84076 3.62021 6.08845 2.98888 7.36761 2.98888L8.99902 2.98811V0.126204C8.2094 0.0393111 7.41579 -0.00277197 6.62175 0.000141894C4.26962 0.000141894 2.65931 1.49131 2.65931 4.22982V6.5896H-0.000977V9.78943H2.65931V18H5.84076Z' fill='#333333')
                li.social-list__item
                    a.link(href="https://www.instagram.com")
                        svg.link__icon(width='18' height='18' viewbox='0 0 18 18' fill='none' xmlns='http://www.w3.org/2000/svg')
                            path(d='M9 1.62162C11.4031 1.62162 11.6877 1.63079 12.6368 1.67409C13.5142 1.71413 13.9908 1.86073 14.3079 1.98398C14.6989 2.12826 15.0525 2.35831 15.3428 2.65722C15.6417 2.94753 15.8717 3.30114 16.016 3.69206C16.1393 4.00919 16.2859 4.48575 16.3259 5.36322C16.3692 6.31225 16.3784 6.59689 16.3784 9C16.3784 11.4031 16.3692 11.6877 16.3259 12.6368C16.2859 13.5143 16.1393 13.9908 16.016 14.3079C15.8663 14.6961 15.637 15.0486 15.3428 15.3428C15.0486 15.637 14.6961 15.8663 14.3079 16.016C13.9908 16.1393 13.5142 16.2859 12.6368 16.3259C11.6879 16.3692 11.4033 16.3784 9 16.3784C6.59673 16.3784 6.31211 16.3692 5.36323 16.3259C4.48575 16.2859 4.00919 16.1393 3.69205 16.016C3.30114 15.8717 2.94754 15.6417 2.65723 15.3428C2.35831 15.0525 2.12826 14.6989 1.98398 14.3079C1.86073 13.9908 1.71413 13.5143 1.67408 12.6368C1.63079 11.6877 1.62162 11.4031 1.62162 9C1.62162 6.59689 1.63079 6.31225 1.67409 5.36323C1.71413 4.48575 1.86073 4.00919 1.98398 3.69206C2.12826 3.30115 2.3583 2.94754 2.65721 2.65723C2.94753 2.35831 3.30114 2.12826 3.69205 1.98398C4.00919 1.86073 4.48575 1.71413 5.36322 1.67408C6.31225 1.63079 6.59689 1.62162 9 1.62162ZM9 0C6.55574 0 6.24925 0.0103525 5.28931 0.0541492C4.33135 0.0978619 3.67714 0.250003 3.10465 0.472489C2.50412 0.698472 1.96011 1.05273 1.51056 1.51056C1.05273 1.96011 0.698472 2.50412 0.472489 3.10465C0.250002 3.67714 0.0978616 4.33135 0.0541496 5.28931C0.0103525 6.24926 0 6.55574 0 9C0 11.4443 0.0103525 11.7507 0.0541492 12.7107C0.0978616 13.6686 0.250002 14.3229 0.472489 14.8954C0.698473 15.4959 1.05273 16.0399 1.51056 16.4894C1.96011 16.9473 2.50412 17.3015 3.10465 17.5275C3.67714 17.75 4.33135 17.9021 5.28931 17.9459C6.24926 17.9897 6.55574 18 9 18C11.4443 18 11.7507 17.9897 12.7107 17.9459C13.6686 17.9021 14.3229 17.75 14.8954 17.5275C15.4932 17.2963 16.0362 16.9427 16.4894 16.4894C16.9427 16.0362 17.2963 15.4932 17.5275 14.8954C17.75 14.3229 17.9021 13.6686 17.9458 12.7107C17.9896 11.7507 18 11.4443 18 9C18 6.55574 17.9896 6.24926 17.9458 5.28931C17.9021 4.33135 17.75 3.67714 17.5275 3.10465C17.3015 2.50412 16.9473 1.96011 16.4894 1.51056C16.0399 1.05273 15.4959 0.698472 14.8954 0.472489C14.3229 0.250003 13.6686 0.0978619 12.7107 0.0541496C11.7507 0.0103529 11.4443 0 9 0Z' fill='#333333')
                            path(d='M9.00013 4.3783C8.08606 4.3783 7.19251 4.64936 6.43249 5.15719C5.67247 5.66502 5.08011 6.38681 4.73031 7.23131C4.38051 8.0758 4.28898 9.00505 4.46731 9.90156C4.64564 10.7981 5.0858 11.6216 5.73215 12.2679C6.37849 12.9142 7.20199 13.3544 8.09849 13.5327C8.995 13.7111 9.92425 13.6195 10.7687 13.2697C11.6132 12.9199 12.335 12.3276 12.8429 11.5676C13.3507 10.8075 13.6217 9.91399 13.6217 8.99992C13.6217 8.393 13.5022 7.79203 13.2699 7.23131C13.0377 6.67058 12.6973 6.1611 12.2681 5.73194C11.8389 5.30279 11.3295 4.96236 10.7687 4.7301C10.208 4.49784 9.60705 4.3783 9.00013 4.3783ZM9.00013 11.9999C8.40678 11.9999 7.82676 11.824 7.33342 11.4943C6.84007 11.1647 6.45555 10.6961 6.22849 10.148C6.00143 9.59979 5.94202 8.99659 6.05777 8.41465C6.17353 7.83271 6.45925 7.29816 6.87881 6.8786C7.29837 6.45904 7.83292 6.17332 8.41486 6.05757C8.9968 5.94181 9.6 6.00122 10.1482 6.22828C10.6964 6.45535 11.1649 6.83987 11.4945 7.33321C11.8242 7.82656 12.0001 8.40658 12.0001 8.99992C12.0001 9.79557 11.6841 10.5586 11.1214 11.1212C10.5588 11.6839 9.79578 11.9999 9.00013 11.9999Z' fill='#333333')
                            path(d='M13.8043 5.27584C14.4007 5.27584 14.8843 4.79231 14.8843 4.19584C14.8843 3.59937 14.4007 3.11584 13.8043 3.11584C13.2078 3.11584 12.7243 3.59937 12.7243 4.19584C12.7243 4.79231 13.2078 5.27584 13.8043 5.27584Z' fill='#333333')
                li.social-list__item
                    a.link(href="https://vk.com")
                        svg.link__icon(width='23' height='14' viewbox='0 0 23 14' fill='none' xmlns='http://www.w3.org/2000/svg')
                            path(d='M19.1054 6.86438C19.1054 6.86438 22.136 2.42026 22.4371 0.959762C22.5374 0.438197 22.3167 0.145937 21.7948 0.145937H19.1657C18.5636 0.145937 18.3428 0.417223 18.1622 0.813674C18.1622 0.813674 16.7407 3.9623 15.0112 5.94642C14.456 6.58786 14.1737 6.7809 13.8672 6.7809C13.62 6.7809 13.506 6.56669 13.506 5.98805V0.918025C13.506 0.208691 13.4257 2.30391e-07 12.8638 2.30391e-07H8.64911C8.32798 2.30391e-07 8.12727 0.194096 8.12727 0.458968C8.12727 1.12701 9.11069 1.27782 9.11069 3.08791V6.82264C9.11069 7.57377 9.07054 7.86588 8.72936 7.86588C7.82625 7.86588 5.67876 4.63194 4.4746 0.959762C4.23374 0.208691 3.97283 2.30391e-07 3.29046 2.30391e-07H0.661345C0.280009 2.30391e-07 -0.000976248 0.271146 -0.000976248 0.667554C-0.000976248 1.39781 0.821865 4.77792 4.05317 9.30555C6.22066 12.3517 9.07055 14 11.6395 14C13.205 14 13.5863 13.7289 13.5863 13.0402V10.7034C13.5863 10.1192 13.807 9.86886 14.1282 9.86886C14.4894 9.86886 15.127 9.98955 16.6168 11.5171C18.383 13.2698 18.5034 14 19.4668 14H22.417C22.718 14 22.999 13.854 22.999 13.3323C22.999 12.6438 22.136 11.4128 20.8114 9.95228C20.2695 9.20121 19.3864 8.38749 19.1054 8.01195C18.7041 7.57377 18.8245 7.32334 19.1054 6.86438Z' fill='#333333')
        .modal-reg__footer
            .button(@click="registration" :class="{ 'active': valid }") Зарегестрироваться
            .group-accept
                input.cbx-input#accept(type='checkbox' v-model="isCbx")
                label.cbx(for="accept")
                    span.cbx-icon
                        svg(width='14px', height='12px', viewbox='0 0 14 12')
                            polyline(points='1.5 6 4.5 9 10.5 1')
                    span.cbx-text Согласен с условиями пользовательского соглашения
</template>

<script>

import axios from 'axios'

function generateSecret() {
    return Math.floor(Math.random() * 9000 + 1000)
}

export default {
    data: () => ({
        isPhoneFocus: false,
        isPhoneValid: false,
        isCbx: false,

        phoneNumber: null
    }),
    computed: {
        russiaPhoneMask() {
            return ['+', 7, ' ', '(', /[1-9]/, /\d/, /\d/, ')', ' ', /\d/, /\d/, /\d/, ' ', /\d/, /\d/, ' ', /\d/, /\d/]
        },
        valid() {
            return this.isPhoneValid && this.isCbx
        }
    },
    methods: {
        registration() {
            if (this.valid) {
                window.SECRET_CODE = generateSecret()
                axios('/test.php', {
                    params: {
                        api: 'send',
                        phone: `${this.phoneNumber.replace(/[\s+\(\)]/g, '')}`,
                        secret: window.SECRET_CODE
                    }
                }).then(response => {
                    window.ID_CODE = response.data.data.id;
                    this.$emit('handler-select', 'modal-conf')
                })
                window.PHONE = this.phoneNumber;
            }
        },
        validPhone() {
            let regExp = /^[+]7[\s]\([0-9]{1,3}\)\s[0-9]{1,3}\s[0-9]{1,2}\s[0-9]{1,2}$/gm;
            this.isPhoneValid = regExp.test(this.phoneNumber)
        }
    }
}
</script>